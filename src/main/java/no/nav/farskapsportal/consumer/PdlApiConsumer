@Slf4j
@Component
@RequiredArgsConstructor
public class PdlApiConsumer {
  private final NavSts sts;
  private final RestTemplate restTemplate;
  private final UrlProperties properties;

  @Retryable
  public GraphQLResponse fetchPersondokument(String ident, String query) {
    val graphQlRequest = GraphQLRequest.builder()
        .query(query)
        .variables(Map.of(
            "historikk", false,
            "ident", ident))
        .build();

    val requestEntity = RequestEntity.post(URI.create(properties.getPdlApi().getGraphql()))
        .header(AUTHORIZATION, sts.getBearerToken())
        .header(NAV_CONSUMER_TOKEN, sts.getBearerToken())
        .header(TEMA, "GEN")
        .body(graphQlRequest);


    GraphQLResponse response = restTemplate.exchange(requestEntity, GraphQLResponse.class).getBody();

    return checkForPdlApiErrors(response);
  }